- name: Install vim
  ansible.builtin.package: name=vim state=present

# Plugin manager
- name: Makes sure autoload directory exists
  ansible.builtin.file: path="{{dotfiles_user_home}}/.vim/autoload" state=directory

- name: Install vim-plug
  ansible.builtin.get_url:
    url: https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    dest: "{{dotfiles_user_home}}/.vim/autoload/plug.vim"

# Snippets
- name: Makes sure UltiSnips directory exists
  ansible.builtin.file: path="{{dotfiles_user_home}}/.vim/UltiSnips" state=directory

- name: Symlink all snippet files
  ansible.builtin.file:
    src: "{{ dotfiles_home }}/roles/vim/files/{{item}}"
    dest: "{{ dotfiles_user_home}}/.vim/UltiSnips/{{item}}"
    state: link
  with_items:
    - "python.snippets"
    - "rst.snippets"
    - "javascript.snippets"

# Configuration
- name: Check if vimrc exists
  ansible.builtin.stat: path="{{dotfiles_user_home}}/.vimrc"
  register: vimrc_stat
  failed_when: False

- name: Backup vimrc
  ansible.builtin.command: mv ~/.vimrc ~/.vimrc.bak
  args:
    creates: "{{dotfiles_user_home}}/.vimrc.bak"
  when: vimrc_stat.stat.exists

- name: Symlink vimrc
  ansible.builtin.file:
    src: "{{ dotfiles_home }}/roles/vim/files/vimrc"
    dest: "{{dotfiles_user_home}}/.vimrc"
    state: link

- name: Install plugins
  ansible.builtin.command: vim +PlugInstall +qall
  when: vim_install_plugins|bool
